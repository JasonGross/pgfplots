\testfile{pgfplotstest.smithchart.tex}
\testsection{Smith Charts}

\testsubsection{First steps: default params}
\begin{tikzpicture}
%\tracingmacros=2 \tracingcommands=2
	\begin{smithchartaxis}[
	]
	\addplot+[domain=-5:5] (0.5,\x);
	\addlegendentry{$x=0.5$}
	\end{smithchartaxis}
\end{tikzpicture}
%\endinput %FIXME

\testsubsection{First steps: providing tick positions manually}
this is a little bit crude for testing

\begin{tikzpicture}
%\tracingmacros=2 \tracingcommands=2
	\begin{smithchartaxis}[
		width=10cm,
		height=10cm,
		xtick={
			0,0.1,0.2,...,1,1.5,2,3,4,5,10,20,50%
		},
		ytick={%
			0,%
			0.1,0.2,...,1,1.5,2,3,4,5,10,20,50,%
			-0.1,-0.2,...,-1,-1.5,-2,-3,-4,-5,-10,-20,-50%
		},
		minor xtick={1.1,1.2,1.3,1.4,1.6,1.7,1.8,1.9,2.2,2.4,2.6,2.8,3.2,3.4,3.6,3.8,4.5,6,7,8,9},
		minor ytick={%
			1.1,1.2,1.3,1.4,1.6,1.7,1.8,1.9,2.2,2.4,2.6,2.8,3.2,3.4,3.6,3.8,4.5,6,7,8,9,%
			-1.1,-1.2,-1.3,-1.4,-1.6,-1.7,-1.8,-1.9,-2.2,-2.4,-2.6,-2.8,-3.2,-3.4,-3.6,-3.8,-4.5,-6,-7,-8,-9%
		},
		%xtick={0,30,...,360},
	]
	\addplot+[domain=-5:5] (0.5,\x);
	\addlegendentry{$x=0.5$}
	\pgfplotsextra{%
		\draw[red] (1,1) circle (\pgfplotspointxaxislength/2);
	}
	\end{smithchartaxis}
\end{tikzpicture}

\testsubsection{With xgrid each nth passes y}
\begin{tikzpicture}
%\tracingmacros=2 \tracingcommands=2
	\begin{smithchartaxis}[
		width=10cm,
		height=10cm,
		xmin=0,xmax=5,
		ymin=-5,ymax=5,
		xgrid each nth passes y={0.5,2},
		%xtick={0,30,...,360},
	]
	\end{smithchartaxis}
\end{tikzpicture}
%\endinput %FIXME

\begin{tikzpicture}
%\tracingmacros=2 \tracingcommands=2
	\begin{smithchartaxis}[
		width=10cm,
		height=10cm,
		xmin=0,xmax=50,
		ymin=-50,ymax=50,
		xtick={
			0,0.1,0.2,...,1,1.5,2,3,4,5,10,20,50%
		},
		ytick={%
			0,%
			0.1,0.2,...,1,1.5,2,3,4,5,10,20,50,%
			-0.1,-0.2,...,-1,-1.5,-2,-3,-4,-5,-10,-20,-50%
		},
		minor xtick={1.1,1.2,1.3,1.4,1.6,1.7,1.8,1.9,2.2,2.4,2.6,2.8,3.2,3.4,3.6,3.8,4.5,6,7,8,9},
		minor ytick={%
			1.1,1.2,1.3,1.4,1.6,1.7,1.8,1.9,2.2,2.4,2.6,2.8,3.2,3.4,3.6,3.8,4.5,6,7,8,9,%
			-1.1,-1.2,-1.3,-1.4,-1.6,-1.7,-1.8,-1.9,-2.2,-2.4,-2.6,-2.8,-3.2,-3.4,-3.6,-3.8,-4.5,-6,-7,-8,-9%
		},
		xgrid each nth passes y={1,2,4,5,10,20},
		%xtick={0,30,...,360},
	]
	\end{smithchartaxis}
\end{tikzpicture}

\testsubsection{With ygrid each nth passes x}
\begin{tikzpicture}
%\tracingmacros=2 \tracingcommands=2
	\begin{smithchartaxis}[
		width=10cm,
		height=10cm,
		xmin=0,xmax=5,
		ymin=-5,ymax=5,
		ygrid each nth passes x={1,2},
	extra x ticks=0.5,
		%xtick={0,30,...,360},
	]
	\addplot+[domain=-5:5] (0.5,\x);
	\addlegendentry{$x=0.5$}
	\end{smithchartaxis}
\end{tikzpicture}
%\endinput %FIXME

\begin{tikzpicture}
%\tracingmacros=2 \tracingcommands=2
	\begin{smithchartaxis}[
		width=10cm,
		height=10cm,
		xmin=0,xmax=50,
		ymin=-50,ymax=50,
		xtick={
			0,0.1,0.2,...,1,1.5,2,3,4,5,10,20,50%
		},
		ytick={%
			0,%
			0.1,0.2,...,1,1.5,2,3,4,5,10,20,50,%
			-0.1,-0.2,...,-1,-1.5,-2,-3,-4,-5,-10,-20,-50%
		},
		minor xtick={1.1,1.2,1.3,1.4,1.6,1.7,1.8,1.9,2.2,2.4,2.6,2.8,3.2,3.4,3.6,3.8,4.5,6,7,8,9},
		minor ytick={%
			1.1,1.2,1.3,1.4,1.6,1.7,1.8,1.9,2.2,2.4,2.6,2.8,3.2,3.4,3.6,3.8,4.5,6,7,8,9,%
			-1.1,-1.2,-1.3,-1.4,-1.6,-1.7,-1.8,-1.9,-2.2,-2.4,-2.6,-2.8,-3.2,-3.4,-3.6,-3.8,-4.5,-6,-7,-8,-9%
		},
		ygrid each nth passes x={1,2,3,5,10:3,20:3},
		%xtick={0,30,...,360},
	]
	\addplot+[domain=-5:5] (0.5,\x);
	\addlegendentry{$x=0.5$}
	\pgfplotsextra{%
		\draw[red] (1,1) circle (\pgfplotspointxaxislength/2);
	}
	\end{smithchartaxis}
\end{tikzpicture}

\testsubsection{With ygrid each nth passes x and xgrid each nth passes y}
\begin{tikzpicture}
%\tracingmacros=2 \tracingcommands=2
	\begin{smithchartaxis}[
		width=10cm,
		height=10cm,
		xmin=0,xmax=5,
		ymin=-5,ymax=5,
		ygrid each nth passes x={1,2},
		xgrid each nth passes y={2},
	extra x ticks=0.5,
		%xtick={0,30,...,360},
	]
	\addplot+[domain=-5:5] (0.5,\x);
	\addlegendentry{$x=0.5$}
	\end{smithchartaxis}
\end{tikzpicture}
%\endinput %FIXME

\begin{tikzpicture}
%\tracingmacros=2 \tracingcommands=2
	\begin{smithchartaxis}[
		width=10cm,
		height=10cm,
		xmin=0,xmax=50,
		ymin=-50,ymax=50,
		xtick={
			0,0.1,0.2,...,1,1.5,2,3,4,5,10,20,50%
		},
		ytick={%
			0,%
			0.1,0.2,...,1,1.5,2,3,4,5,10,20,50,%
			-0.1,-0.2,...,-1,-1.5,-2,-3,-4,-5,-10,-20,-50%
		},
		minor xtick={1.1,1.2,1.3,1.4,1.6,1.7,1.8,1.9,2.2,2.4,2.6,2.8,3.2,3.4,3.6,3.8,4.5,6,7,8,9},
		minor ytick={%
			1.1,1.2,1.3,1.4,1.6,1.7,1.8,1.9,2.2,2.4,2.6,2.8,3.2,3.4,3.6,3.8,4.5,6,7,8,9,%
			-1.1,-1.2,-1.3,-1.4,-1.6,-1.7,-1.8,-1.9,-2.2,-2.4,-2.6,-2.8,-3.2,-3.4,-3.6,-3.8,-4.5,-6,-7,-8,-9%
		},
		ytick align=outside,
		ticklabel style={font=\tiny},
		xgrid each nth passes y={1,2,4,5,10,20},
		ygrid each nth passes x={1,2,3,5,10:3,20:3},
		%xtick={0,30,...,360},
	]
	\addplot+[domain=-5:5] (0.5,\x);
	\addlegendentry{$x=0.5$}
	\end{smithchartaxis}
\end{tikzpicture}


\testsubsection{With data in smithchart cs}
\testsubsubsection{autolimits}
\begin{tikzpicture}
%\tracingmacros=2 \tracingcommands=2
	\begin{smithchartaxis}[
		width=10cm,
		height=10cm,
	]
	\addplot+[mark=none,is smithchart cs] file {plotdata/smithchart_data.dat};
	\addlegendentry{Data}
	\end{smithchartaxis}
\end{tikzpicture}

\testsubsubsection{manual limits + ticks}
\begin{tikzpicture}
%\tracingmacros=2 \tracingcommands=2
	\begin{smithchartaxis}[
		width=10cm,
		height=10cm,
		xmin=0,xmax=5,
		ymin=-50,ymax=50,
		xtick={0.2,0.5,1,2,5},
		ytick={
			 0.2, 0.5, 1, 2, 5,
			-0.2,-0.5,-1,-2,-5},
	]
	\addplot+[mark=none,is smithchart cs] file {plotdata/smithchart_data.dat};
	\addlegendentry{Data}
	\end{smithchartaxis}
\end{tikzpicture}

\testsubsubsection{manual limits + ticks + ygrid each nth passes x}
\begin{tikzpicture}
	\begin{smithchartaxis}[
		width=10cm,
		height=10cm,
		xmin=0,xmax=5,
		ymin=-50,ymax=50,
		xtick={0.2,0.5,1,2,5},
		ytick={
			 0.2, 0.5, 1, 2, 5,
			-0.2,-0.5,-1,-2,-5},
		ygrid each nth passes x={1,2,5},
	]
	\addplot+[mark=none,is smithchart cs] file {plotdata/smithchart_data.dat};
	\addlegendentry{Data}
	\end{smithchartaxis}
\end{tikzpicture}

\testsubsection{With xgrid stop at y}
\begin{tikzpicture}
%\tracingmacros=2 \tracingcommands=2
	\begin{smithchartaxis}[
		width=10cm,
		height=10cm,
		xmin=0,xmax=5,
		ymin=-5,ymax=5,
		xgrid stop at y={0.2:0.2 1:2 5:5},
		%xtick={0,30,...,360},
	]
	\end{smithchartaxis}
\end{tikzpicture}

\testsubsection{With ygrid stop at x}
\begin{tikzpicture}
%\tracingmacros=2 \tracingcommands=2
	\begin{smithchartaxis}[
		width=10cm,
		height=10cm,
		xmin=0,xmax=5,
		ymin=-5,ymax=5,
		ygrid stop at x={0.2:1 1:5 2:0.5 5:5},
		%xtick={0,30,...,360},
	]
	\end{smithchartaxis}
\end{tikzpicture}

\testsubsection{Testing the difficulty with the 1--circle}
\begin{tikzpicture}
%\tracingmacros=2 \tracingcommands=2
	\begin{smithchartaxis}[
		width=10cm,
		height=10cm,
		xmin=0,xmax=5,
		ymin=-5,ymax=5,
		ytick={0,0.1,0.2,...,1},
		ygrid stop at x={1:2},
		%xtick={0,30,...,360},
	]
	\pgfplotsextra{%
		\draw[red] (1,1) circle (\pgfplotspointxaxislength/2);
	}
	\end{smithchartaxis}
\end{tikzpicture}

Numerical instability:
\verb|\pgfmathparse{acos(-1.00008* 0.99992)}\pgfmathresult|
\pgfmathparse{acos(-1.00008* 0.99992)}\pgfmathresult
; should be 180 --- three degrees difference. pgfpatharc uses these angles and causes thus visible errors.  work--around: don't use the dots notation in xtick/ytick

Fixed now: I implemented a specialized patharc
